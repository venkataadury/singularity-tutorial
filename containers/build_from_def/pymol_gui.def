Bootstrap: docker
From: nvidia/cuda:12.6.3-base-ubuntu24.04 # Base

%environment
    export LC_ALL=C
    export PATH="/alphafold3_venv/bin:/hmmer/bin:/bin:/usr/bin:$PATH"
    export XLA_FLAGS="--xla_gpu_enable_triton_gemm=false"
    export XLA_PYTHON_CLIENT_PREALLOCATE=true
    export XLA_CLIENT_MEM_FRACTION=0.95

%post
    #which nvcc 
    apt-get -y update
    apt-get install --yes --quiet python3.12 python3-pip python3.12-venv python3.12-dev
    apt-get install --yes --quiet git wget gcc g++ make zlib1g-dev zstd patch libgl1-mesa-dev libglu1-mesa-dev libglew-dev
    apt-get install --yes qtcreator qtbase5-dev qt5-qmake cmake

    
    python3 -m venv /pymol_venv # Make a python virtual environment (you can do this without conda)
    export PATH="/pymol_venv/bin:/bin:/usr/bin:$PATH" # Update PATH to add virtual environment
    echo $PATH && which pip3 # Check path and ensure pip3 exists as a command (useful for debugging if any future command crashes)
    pip3 install --no-cache-dir --upgrade pip # Always use '--no-cache-dir' in containers because any cache is wasted space

    pip3 install pyqt5 pymol-open-source # Install PyMol and PyQt5 (PyQt5 is the GUI software)
    mkdir -p /mnt_local # Reserve a mount point for the future

    echo "#!/bin/bash \n source /pymol_venv/bin/activate && pymol $@" > /pymol_venv/bin/_pymol # Prepare an executable for launch (optional)
    chmod +x /pymol_venv/bin/_pymol

%runscript
    /pymol_venv/bin/_pymol $@
